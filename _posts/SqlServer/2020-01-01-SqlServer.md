---
title: SqlServer收集
categories: DB
permalink: /posts/sqlserver.html
toc: true
date: 2019-01-01
---

## SQL SERVER
### 创建表
```
--AUTHOR:XXX
--DATE:XXXX-XX-XX
--DESCRIPTION:创建表

IF NOT EXISTS (SELECT * FROM DBO.SYSOBJECTS WHERE ID = OBJECT_ID(N'表名') AND OBJECTPROPERTY(ID, N'ISUSERTABLE') = 1)
create table 表名  (
  ID            VARCHAR(32),  
  字段名        DECIMAL(15,2),
  字段名        DATETIME,
  constraint 主键名 primary key (ID)
);
GO
```
### 删除表
```
--AUTHOR:XXX
--DATE:XXXX-XX-XX
--DESCRIPTION:删除表

--在SqlServer2016版本及更高版本，可以使用
DROP TABLE IF EXISTS 表名;

--在SqlServer2016版本以下,使用
IF OBJECT_ID(N'dbo.TEST_USER', N'U') IS  NOT  NULL 
DROP TABLE dbo.TEST_USER;
```
### 新增表字段
```
--AUTHOR:XXX
--DATE:XXXX-XX-XX
--DESCRIPTION:新增表字段

IF NOT EXISTS (SELECT 1 FROM dbo.SYSCOLUMNS WHERE ID=OBJECT_ID('表名') AND NAME='字段名')
    ALTER TABLE 表名 ADD 字段名 字段类型;
GO
```
### 修改表字段
```
--AUTHOR:XXX
--DATE:XXXX-XX-XX
--DESCRIPTION:修改表字段

IF NOT EXISTS (SELECT 1 FROM DBO.SYSCOLUMNS WHERE ID=OBJECT_ID('表名') AND NAME='字段名')
	ALTER TABLE 表名 ADD 字段名 字段类型;
ELSE
	ALTER TABLE 表名 ALTER COLUMN 字段名 字段类型;
GO
```
### 删除表字段
```
--AUTHOR:XXX
--DATE:XXXX-XX-XX
--DESCRIPTION:删除表字段

IF EXISTS (SELECT 1 FROM DBO.SYSCOLUMNS WHERE ID=OBJECT_ID('表名') AND NAME = '字段名')
ALTER TABLE 表名 DROP COLUMN 字段名;
GO
```
### 新增数据
```
--AUTHOR:XXX
--DATE:XXXX-XX-XX
--DESCRIPTION:新增数据
IF NOT EXISTS (SELECT * FROM 表名 WHERE ID='XX') 
	INSERT INTO  表名 (ID, NAME, AGE) 
	VALUES ('XX', 'XX', 'XX');
GO
```
### 修改数据
```
--AUTHOR:XXX
--DATE:XXXX-XX-XX
--DESCRIPTION:修改数据

UPDATE 表名 SET 字段名 = '字段值' WHERE ID = 'XX';
GO
```
### 删除数据
```
--AUTHOR:XXX
--DATE:XXXX-XX-XX
--DESCRIPTION:删除数据

DELETE FROM 表名 WHERE 表名.ID='XX';
GO
```
### 新增主键
```
IF NOT EXISTS(SELECT * FROM SYSOBJECTS WHERE NAME='PK_表名' AND TYPE='P')
BEGIN 
  ALTER TABLE 表名 ADD CONSTRAINT PK_表名 PRIMARY KEY(ID);
END 
GO
```
### 新增索引
```
IF EXISTS (SELECT COUNT(*) FROM SYS.INDEXES WHERE NAME='IDX_表名') 
CREATE INDEX IDX_表名 ON TEST_USER(字段名)
GO 

```
### 删除索引
```
IF EXISTS (SELECT COUNT(*) FROM SYS.INDEXES WHERE NAME='IDX_表名') 
DROP INDEX IDX_表名 ON 表名
GO 

```
